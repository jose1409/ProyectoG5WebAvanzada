@model IEnumerable<Proyecto.UI.Models.Categoria>

@{
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

<h1>Categorias</h1>

<p>
    <button class="btn btn-sm btn-primary btnAgregarCategoria"
            data-edicion="false"
            data-toggle="modal"
            data-target="#ActualizarCategoriaModal">
        Agregar nueva Categoria
    </button>
</p>
<table class="table">
    <thead>
        <tr>
            <th>#</th>
            <th>
                @Html.DisplayNameFor(model => model.Descripcion)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Imagen)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Activo)
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
@foreach (var item in Model) {
        <tr>
            <td>@item.IdCategoria</td>
            <td>
                @Html.DisplayFor(modelItem => item.Descripcion)
            </td>
            <td>
                @if (item.Imagen != null && item.Imagen.Length > 0)
                {
                    var imagenBase64 = "data:image/png;base64," + Convert.ToBase64String(item.Imagen);
                    <img src="@imagenBase64" alt="Imagen" style="width: 80px; height: auto;" />
                } else
                {
                    <span class="text-muted">Sin imagen</span>
                }
            </td>
            <td>@(item.Activo ? "Activo" : "Inactivo")</td>
            <td>
                    <button class="btn btn-sm btn-primary btnEditarCategoria"
                            data-id="@item.IdCategoria"
                            data-descripcion="@item.Descripcion"
                            data-activo="@item.Activo"
                            data-imagen="data:image/png;base64,@Convert.ToBase64String(item.Imagen ?? new byte[0])"
                            data-edicion="true"
                            data-toggle="modal"
                            data-target="#ActualizarCategoriaModal">
                        Editar
                    </button> |
                    @Html.ActionLink("Eliminar", "EliminarCategoria", new { idCategoria = item.IdCategoria })
            </td>
        </tr>
}
    </tbody>
</table>


<!-- Modal para Crear/Editar Categoría -->
<div class="modal fade" id="ActualizarCategoriaModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalCategoriaLabel">Categoría</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Cerrar">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body">

                <input type="hidden" id="IdCategoria" name="IdCategoria" class="form-control">

                <div class="form-group">
                    <label>Descripción</label>
                    <input type="text" id="DescripcionCategoria" name="Descripcion" class="form-control">
                </div>

                <div class="form-group">
                    <div style="display: inline-flex; align-items: center;">
                        <input type="file" id="ImagenGrid" name="Imagen" onchange="previewImageGrids(this)" >
                        <div id="previewImagen" style="display: block" >
                            <!-- Imagen previa se insertará aquí -->
                        </div>
                    </div>
                </div>

                <!-- Switch de estado -->
                <div class="form-group d-flex align-items-center">
                    <label class="mb-0 mr-2">Activo</label>
                    <label class="toggle-switch mb-0">
                        <input type="checkbox" id="estadoCategoria" name="Activo">
                        <span class="slider"></span>
                    </label>
                </div>
                <input type="hidden" id="ImagenBase64Actual" name="ImagenBase64Actual" />
                <input type="hidden" id="edicionEstado" name="edicion" class="form-control" />

            </div>
            <div class="modal-footer">
                <button type="button" id="btnGuardarModalCategoria" class="btn btn-primary">Guardar</button>
            </div>
        </div>
    </div>
</div>

<script src="~/lib/jquery.min.js"></script>
<script src="~/js/Categoria/LlenarModal.js"></script>
<script src="~/js/PreviewPhotoGrids/PreviewPhotoGrids.js"></script>
